<html>
<head>
	<title>Difoosion Chat</title>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	<script>
		$(document).ready(function() {
			var sendMessage = function() {
				$.post('SendMessage', { message: $("#message").val() }, function(result) {
					loadMessages();
				});
				$("#message").val("");
			};
			var loadMessages = function() {
				$.get('/NewMessages', function(messages) {
					var message = undefined;
					var messagesId = "messages" + (new Date()).getTime();
					var html = '<ul id="' + messagesId + '">';
					jQuery.each(messages, function() {
						var timestamp = new Date(this.timestamp);
						var time = timestamp.getHours().toString() + ":" + timestamp.getMinutes().toString() + ":" + timestamp.getSeconds().toString();
						html += '<li>' + time + ": " + this.message + '</li>';
					});
					html += '</ul>';
					$('#chat').html(html);
					var objDiv = document.getElementById(messagesId);
					objDiv.scrollTop = objDiv.scrollHeight;
				});
			};
			
			$("#message").keypress(function(e)
			{
				code = (e.keyCode ? e.keyCode : e.which);
				if (code == 13) {
					sendMessage();
					e.preventDefault();
				}
			});
			
			window.setInterval(loadMessages, 1000);
			
			loadMessages();
		});
	</script>
	<style>
		body { margin: 0; background-color: #9E8E9E; font-family: 'Open Sans', sans-serif }
		.container { width: 1000px; margin: 0 auto; }
		.container_inner { width: 1000px; position: fixed; bottom: 0; padding: 10px; background-color: #fff}
		#chat ul { list-style-type: none; padding: 0; height: 500px; overflow:auto }
		.message_box { margin: 2px auto }
		.message_box input { width: 100% }
	</style>
</head>
<body>
	<div class="container">
		<div class="container_inner">
			<h1>Difoosion Room</h1>

			<div id="chat"></div>
				
			<div class="message_box">
				<input type="text" id="message" />
			</div>
		</div>
	</div>
</body>