<!DOCTYPE html>
<html>
<head>
	<title>Difoosion Chat</title>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	<script>
		$(document).ready(function() {
			var lastRequest = 0;
			var sendMessage = function() {
				$.ajax({
					type: "POST",
					url: "SendMessage",
					data: { message: $("#message").val() }
				}).done(function( msg ) {
					loadMessages();
				});
				$("#message").val("");
			};
			var loadMessages = function() {
				$.ajax({
					type: "GET",
					url: "NewMessages",
					data: { timestamp: lastRequest }
				}).done(function( response ) {
					lastRequest = response.timestamp;
					var messages = response.messages;
					var message = undefined;
					var html = "";
					jQuery.each(messages, function() {
						var timestamp = new Date(this.timestamp);
						var time = timestamp.getHours().toString() + ":" + timestamp.getMinutes().toString() + ":" + timestamp.getSeconds().toString();
						html += '<li>' + time + ": " + this.message + '</li>';
					});
					$('#messages').append(html);
					var messagesDiv = document.getElementById("messages");
					messagesDiv.scrollTop = messagesDiv.scrollHeight;
				});
			};
			
			$("#message").keypress(function(e)
			{
				code = (e.keyCode ? e.keyCode : e.which);
				if (code == 13) {
					sendMessage();
					e.preventDefault();
				}
			});
			
			window.setInterval(loadMessages, 2500);
			
			loadMessages();
		});
	</script>
	<style>
		body { margin: 0; background-image:url('bg.jpg'); font-family: 'Open Sans', sans-serif; font-size: 11pt }
		h1 { color: #543A59 }
		.container { width: 640px; margin: 0 auto; }
		.container_inner { width: 640px; position: fixed; bottom: 0; padding: 10px; background-color: #fff}
		.chat ul { list-style-type: none; padding: 0; height: 320px; overflow:auto }
		.message_box { margin: 2px auto }
		.message_box input { width: 100% }
		.powered_by_nodejs { position: fixed; margin: 10px; bottom: 0px; right: 0px }
	</style>
</head>
<body>
	<div class="container">
		<div class="container_inner">
			<h1>Difoosion Room</h1>

			<div class="chat">
				<ul id="messages">
					
				</ul>
			</div>
				
			<div class="message_box">
				<input type="text" id="message" />
			</div>
			
			<div class="powered_by_nodejs">
				<img src="nodejs-logo.png" />
			</div>
		</div>
	</div>
</body>