<html>
<head>
	<title>Difoosion Chat</title>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	<script>
		$(document).ready(function() {
			var sendMessage = function() {
				$.post('SendMessage', { message: $("#message").val() }, function(result) {
					loadMessages();
				});
				$("#message").val("");
			};
			var loadMessages = function() {
				$.get('/NewMessages', function(messages) {
					var message = undefined;
					var html = '<ul>';
					jQuery.each(messages, function() {
						html += '<li>' + this.message + '</li>';
					});
					html += '</ul>';
					$('#chat').html(html);
				});
			};
			
			$("#message").keypress(function(e)
			{
				code = (e.keyCode ? e.keyCode : e.which);
				if (code == 13) {
					sendMessage();
					e.preventDefault();
				}
			});
			
			window.setInterval(loadMessages, 1000);
			
			loadMessages();
		});
	</script>
</head>
<body>
	<h1>Prueba</h1>

	<div id="chat"></div>

	<form>
		<input type="text" id="message" />
	</form>
</body>