<html>
<head>
	<title>Difoosion Chat</title>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	<script>
		$(document).ready(function() {
			var sendMessage = function() {
				$.post('SendMessage', { message: $("#message").val() }, function(result) {
					loadMessages();
				});
				$("#message").val("");
			};
			var loadMessages = function() {
				$.get('/NewMessages', function(messages) {
					var message = undefined;
					var html = '<ul>';
					jQuery.each(messages, function() {
						html += '<li>' + this.message + '</li>';
					});
					html += '</ul>';
					$('#chat').html(html);
				});
			};
			
			$("#message").keypress(function(e)
			{
				code = (e.keyCode ? e.keyCode : e.which);
				if (code == 13) {
					sendMessage();
					e.preventDefault();
				}
			});
			
			window.setInterval(loadMessages, 1000);
			
			loadMessages();
		});
	</script>
	<style>
		body { margin: 0 }
		.container { width: 1000px; margin: 0 auto }
		.message_box { position: fixed; bottom: 0; width: 1000px; margin: 2px auto }
		.message_box input { width: 100% }
	</style>
</head>
<body>
	<div class="container">
		<h1>Difoosion Room</h1>

		<div id="chat"></div>
			
		<div class="message_box">
			<input type="text" id="message" />
		</div>
	</div>
</body>